<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.9.16">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>XCOM 2 – The KingOli Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../k-typewriter.png" rel="icon" type="image/png">
<script src="../../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-a67ac2868200dddf7a4f0e3ae403775c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-86021494fdb264b41bb370614a82db5e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../../k-typewriter.png" alt="" class="navbar-logo light-content">
    <img src="../../../../k-typewriter.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">The KingOli Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TheGoodCartman"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">XCOM 2</h1>
  <div class="quarto-categories">
    <div class="quarto-category">gespielt</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">02.11.2025 15:44</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Wenn ich über rundenbasierte Taktikspiele (TBT) lese, dann fallen oft die Namen von zwei Serien als die Überspiele des Genres: <em>XCOM</em> und <em>Jagged Alliance</em>. <em>XCOM 2</em> hat inzwischen neun Jahre auf dem Buckel, aber als ich es für die Switch für einen Apfel und ein Ei erstehen konnte, habe ich zugegriffen. Doch ich ahnte nicht, wieviele Ecken und Kanten so ein Spiel bei aller Berühmtheit haben kann.</p>
<section id="erster-versuch" class="level2">
<h2 class="anchored" data-anchor-id="erster-versuch">Erster Versuch</h2>
<p>Beim Start von <em>XCOM 2</em> kam zuerst die Abfrage des Schwierigkeitsgrads. Optimistisch habe ich Veteran ausgewählt (Stufe 2 von 4), da ich ja schon TBTs gespielt habe. Danach gab es noch die Option, zwei “Story-Inhalte” dazu zu schalten. Ich habe das bejaht und mit diesen zwei Wahlmöglichkeiten mein Verderben besiegelt.</p>
<p>Doch bevor ich das merkte ging es erst einmal hinein in das Spiel, das neben den rundenbasiert ablaufenden Einsätzen (Widerstand gegen die Alien-Weltregierung) auch einen nicht zu unterschätzenden Anteil an Echtzeitstrategie aufweist. Die eigene Widerstandsgruppe agiert mit einem <em>Avenger</em> genannten Alien-Raumschiff auf einer Weltkarte und muss dort nicht nur Missionen ansteuern, sondern auch Ressourcen wie <em>Vorräte</em>, <em>Informationen</em> und <em>Alien-Artefakte</em> abbauen. Mit diesen wird dann das Schiff und die eigene Truppe aufgerüstet, was auch dringend notwendig ist, um die Einsätze einfacher zu gestalten.</p>
<p>Als XCOM-Neuling wurde ich aber erschlagen von den vielen Optionen, die ich an Bord der <em>Avenger</em> habe, und die innerhalb des Spiels nicht erklärt werden (genauso wenig wie die meisten Anzeigen in den Einsätzen). Dazu kommt der Faktor Zeit: Es gibt immer wieder Zufallsereignisse, die den Ressourcen-Abbau unterbrechen und damit den eigenen Plan durcheinanderbringen.</p>
<p>So startete ich blauäugig in die ersten Missionen, wo ich viel Lehrgeld zahlte. Die Bewegungsfreiheit der Gegner im Kampf ist verglichen mit anderen TBTs relativ groß. Ehe ich lernte, wie ich sinnvoll meine Einheiten in Deckung bringe, waren bereits die ersten gestorben. Dazu kommen die asymmetrischen Fähigkeiten: Schon gleich am Anfang kämpft man gegen Aliens, die unabhängig von der Deckung mit Psi-Fähigkeiten angreifen können und mit Effekten die eigene, sorgsam aufgebaute Aufstellung durcheinander bringen.</p>
<p>So war ich froh, die Missionen überhaupt mit ein oder zwei Überlebenden zu überstehen. Nur um vom Spiel mitgeteilt zu bekommen, dass jegliche getroffene Einheit nach dem Einsatz ihre Verletzung heilen muss, was kostbare Zeit kostet. Denn in dieser Zeit kann ich die Einheit nicht in Missionen einsetzen, so dass ich neu rekrutieren muss, um beim nächsten Einsatz überhaupt vier Kämpfer zusammen zu bekommen. Und das kostet wiederum Ressourcen, die am Anfang knapp sind.</p>
<p>Wichtig ist zudem, dass die Einheiten je nach ausgeteiltem Schaden aufleveln. Mit dem ersten Levelaufstieg wird eine Klasse des Rekruten ausgewählt (Nahkämpfer/Ranger, Fernkämpfer/Scharfschütze, Grenadier, Techniker), die zu mehr Schaden führt und mit jedem weiteren Aufstieg auch zu Sonderfähigkeiten. Eine gute Einsatztruppe ist möglichst ausgeglichen mit allen Klassen besetzt.</p>
<p>Was ist mir passiert? Durch viele Verletzungen und Verluste sind meine Rekruten nicht so gelevelt, wie ich es gebraucht hätte. Ich musste meist mit klassenlosen Rekruten auskommen, was das Spiel unnötig schwer macht. Und dann kamen auch noch die beiden “Story-Inhalte”, die ich so freigiebig ausgewählt hatte. Dahinter verstecken sich zwei Missionen, die für zwei Crew-Mitglieder an Bord der <em>Avenger</em> eine Art Hintergrundgeschichte liefern. Das ist grundsätzlich keine schlechte Idee, aber zum Einen haben diese Missionen eine ungewöhnliche Länge. Dadurch sind gegen Ende der Mission, wenn die Bossfights warten, schon die limitierten Waffen wie Granaten aufgebraucht. Zum Anderen wird dadurch eine weitere Gemeinheit des Spiels noch früher getriggert: Die drei <em>Alien-Herrscher</em>. Diese sind nicht nur unglaublich mächtige Gegner, sondern können durch die <em>Herrscher-Reaktion</em> auch nach jeder Aktion meines Teams agieren. Normalerweise setze ich die zwei verfügbaren Aktionen pro Einheit alle am Stück ein, woraufhin die Gegner wiederum ihre zwei Aktionen alle am Stück durchführen. Die <em>Alien-Herrscher</em> drängeln sich nun in meine Aktionen: Ich bewege eine eigene Einheit, der <em>Alien-Herrscher</em> schießt. Ich schieße mit einer Einheit, der <em>Alien-Herrscher</em> schießt. Bei einer Truppenstärke von vier Einheiten hat der <em>Alien-Herrscher</em> also vier mal so viele Aktionen wie alle anderen Gegner, und das verändert das Spiel massiv. So ist jegliche Bewegung eigentlich ein weggeworfener Zug, da damit dem <em>Alien-Herrscher</em> eine Schussmöglichkeit eingeräumt wird.</p>
<p>Nach ein paar Missionen stand ich also mit vielen Toten und Verletzten da, musste die kostbare Zeit auf der Weltkarte mit Ressourcen-Mining verbringen, um überhaupt vier Einheiten für die nächste Mission zusammen zu bekommen - und wurde dann von einem Zufallseinsatz überrascht, für den ich nicht genügend Personal hatte.</p>
<p>An der Stelle habe ich das Spiel erst einmal entnervt beiseite gelegt. Und nach einem Tag Wunden-lecken habe ich mir im Netz ein paar Tutorials angesehen und den Resetknopf gedrückt.</p>
</section>
<section id="zweiter-versuch" class="level2">
<h2 class="anchored" data-anchor-id="zweiter-versuch">Zweiter Versuch</h2>
<p>Die erste Änderung in meinem zweiten Anlauf war, die “Story-Inhalte” zu deaktivieren und den einfachsten Schwierigkeitsgrad auszuwählen. Dadurch verhalten sich die Gegner zwar manchmal echt dämlich und tun nicht das Naheliegendste, um mir zu schaden, aber ich musste zumindest keine absolut perfekten Einsätze mehr spielen.</p>
<p>Die nächste wichtige Information war, gleich zu Beginn in der <em>Avenger</em> die Guerillaschule zu bauen, wodurch sich die Gruppengröße auf fünf und später auf sechs Mitglieder erweitern lässt. Und 25% bzw 50% mehr Kampfkraft sind ein wichtiger Faktor, der einem das Überleben in den Einsätzen deutlich erleichtert.</p>
<p>Mit diesen zwei Anpassungen war es mir dann möglich, überhaupt einmal das Spiel in seiner Gesamtheit zu erkunden; alle Möglichkeiten des Ausbaus der <em>Avenger</em> zu probieren und Truppenzusammenstellungen zu testen.</p>
<p>Im Hintergrund tickte immer noch die Zeitbombe der Hauptgeschichte, denn die Aliens sind kurz vor der Vollendung des sogenannten Avatar-Projektes und dessen Verhinderung bildet den Handlungsrahmen von <em>XCOM 2</em>. Aber zumindest war der Rest des Spiels nun zu managen.</p>
<p>Und ohne den ständigen Zeitdruck hatte ich auch Gelegenheit zu beobachten, dass die Kämpfe als Herzstück des Spiels doch sehr generisch sind. Zwar gibt es erfrischend viele unterschiedliche Gegnertypen, die nach und nach eingeführt werden. Und auch die Locations sind optisch wie architektonisch abwechslungsreich. Aber am Ende heißt es eigentlich immer: Entweder alle Gegner töten, oder eine Person befreien/eskortieren (plus alle Gegner töten), oder eine Sprengladung anbringen (und optional alle Gegner töten). Da hätte ich mir doch mehr Vielfalt gewünscht.</p>
</section>
<section id="switch-version" class="level2">
<h2 class="anchored" data-anchor-id="switch-version">Switch-Version</h2>
<p>Im Nachhinein kann ich konstatieren, dass ich mit der Switch die wohl schlechteste Plattform für das Spiel ausgewählt habe. Das fängt an mit der sehr umständlichen Gamepad-Steuerung. Gerade wenn ich die eigene Position plane, um auf weit entfernte Gegner freie Schussbahn zu haben, muss ich aufwendig die Kamera mit dem linken Analogstick verschieben, was unglaublich langsam ist.</p>
<p>Dazu ist die Grafik gar nicht so doll. In der isometrischen Standard-Ansicht sieht das alles noch gut aus, aber bei jedem Schuss zoomt die Kamera heran und zeigt die eher groben Modelle und niedrig aufgelösten Texturen. Für diese Grafik läuft das Spiel deutlich zu langsam.</p>
<p>Die Spiele-Engine selber hat auch ihre Limitierungen. Der zu Beginn der Mission über der Karte liegende Fog of war ist teilweise extremst hässlich. Zudem gibt es immer Clipping-Probleme mit den Gebäuden, ganz zu schweigen von dem schwierigen Handling von mehreren Ebenen. Wenn alles zusammenkommt ist aufgrund der nur in 90° schwenkbaren Kamera manchmal gar nicht erkennbar, wo genau sich der Gegner gerade versteckt.</p>
<p>An Board der <em>Avenger</em> wird es dann ganz schlimm. Das Schiff wird aufgeschnitten aus der Seitenperspektive mit allen verfügbaren Räumen gezeigt. Immer wenn ich von einem Raum zum Nächsten wechsle, zoomt die Kamera hinaus und danach wieder heran - und das in gefühlten 5fps. Das Zoomen ist dabei total unnötig, aber auch so frage ich mich, was da so kompliziert zu rendern ist. Und dafür, dass viel Zeit auf der Weltkarte verbracht wird, ist sie immer nur über zwei dieser langsamen Zooms zu erreichen.</p>
<p>Zu diesen optischen Bugs gesellten sich weitere im Spiel. So wollte das Spiel immer mal den Zug der Gegner nicht beenden. Einige dieser Situationen konnte ich durch Speichern und Neuladen (auch sehr langsam auf der Switch) beheben, aber leider nicht alle. Deshalb habe ich mir angewöhnt, alle paar Minuten händisch zu speichern, da die Autosaves gefühlt nur an bestimmten Punkten getriggert werden. Und musste mit der Limitierung auf sechzig Speicherpunkte leben - why?</p>
</section>
<section id="fazit" class="level2">
<h2 class="anchored" data-anchor-id="fazit">Fazit</h2>
<p>Zumindest auf der Switch kann ich niemandem guten Gewissens <em>XCOM 2</em> empfehlen; zu schlecht ist die Kombination aus Performance, Steuerung und Bugs. Aber auch das Spiel selber hat für mich zu viele Ecken und Kanten, um seinen Ruf zu rechtfertigen. Ohne ein paar längere Video-Tutorials sollte man sich definitiv nicht hinein stürzen, denn <em>XCOM 2</em> erklärt wenig und erwartet viel.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/kingoli\.net\/blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>