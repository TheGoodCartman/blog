<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.5">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Risen – The KingOli Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../k-typewriter.png" rel="icon" type="image/png">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-ff4371ef257df69894857e99c6ad0d06.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-e88df0598ed469d4804a8a37e47ef757.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../../k-typewriter.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">The KingOli Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TheGoodCartman"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Risen</h1>
  <div class="quarto-categories">
    <div class="quarto-category">gespielt</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">24.10.2010 23:08</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Mit dem Kauf meines neuen Laptops war es mir endlich möglich, den inoffiziellen Nachfolger meiner Lieblings-Rollenspiel-Serie <em>Gothic</em> zu spielen. Also habe ich die Gelegenheit beim Schopfe gepackt und mir die kürzlich erschienene Game-of-the-Year-Edition des Spiels zugelegt. Diese enthält neben der leider ungepatchten Verkaufsversion von <em>Risen</em> auch ein Original des bereits 2006 erschienenen <em>Gothic III</em> und eine DVD mit Interviews der Macher.</p>
<p>Piranha-Bytes-typisch schlüpft der Spieler wieder in die Rolle eines namenlosen Helden, der weder in Aussehen noch anfänglichen Attributen angepasst werden kann. Dieser hat sich als blinder Passagier auf das Schiff des mächtigen Inquisitors geschlichen und muss mit ansehen, wie das Schiff im Kampf gegen einen Titanen untergeht. Die Titanen in <em>Risen</em> sind riesige Geschöpfe aus uralten Zeiten, die mit dem Verschwinden der Götter aus ihrem Schlaf aufgewacht sind und die Menschheit zu zerstören drohen. Der Inquisitor will dies verhindern, und so landet der namenlose Held als Schiffbrüchiger mit diesem auf einer Insel, auf der eine magische Flamme in einem Vulkan die Menschheit wie ein Schutzschild vor den Titanen schützt. Der Spieler muss fortan herausfinden, was es mit dieser Flamme und den seltsamen Tempeln auf der Insel auf sich hat und welche Pläne der Inquisitor verfolgt.</p>
<p>Für mich als <em>Gothic</em>-Veteranen fiel der Einstieg in <em>Risen</em> nicht schwer. Im Vergleich zu den vorhergehenden Piranha-Bytes-Spielen hat sich nicht viel getan. Es gibt wie immer drei Fraktionen, unter denen der Spieler wählen kann; es gibt drei grundsätzliche Skillrichtungen (Nahkampf, Fernkampf, Magie) und eine Menge Nebenfertigkeiten wie Diebeskunst, Schmieden und Tiere ausnehmen. Wer jemals ein Spiel der <em>Gothic</em>-Reihe gespielt hat wird sich sofort zurechtfinden, denn große Unterschiede in der Spielmechanik finden sich nicht.</p>
<p>Dabei hat Piranha Bytes aus den Fehlern des Bug-Ungeheuers <em>Gothic III</em> gelernt. Alles ist eine Nummer kleiner und weniger umfangreich als im Vorgängerspiel. Die Spielewelt der nicht näher benannten Insel reiht sich in Sachen Größe zwischen den ersten beiden <em>Gothic</em>-Teilen ein. Der teilweise komplex schöne Talentbaum wurde etwas entschlackt, so dass zum Beispiel Upgrades der Waffen durch Schleifen oder Gifte weggefallen sind. Der Kampf mit zwei Schwertern findet sich ebenfalls nicht mehr - ein Leveln von Geschicklichkeit ist somit Geschichte für den Nahkämpfer, da auch Diebesfertigkeiten wie Schlösser knacken oder Taschendiebstahl unabhängig davon sind. Im Vergleich zu anderen Rollenspielen fehlt es <em>Risen</em> weiterhin an umfangreichen Ausrüstungsmöglichkeiten. Die Optionen beschränken sich auf eine Rüstung, einen Helm und ein Schild (bei einhändigen Waffen), dazu zwei Ringe und ein Amulett. Und viel Auswahl für diese Slots gibt es nicht.</p>
<p>Dafür sind die grundsätzlichen Kampftechniken (Schwertkampf, Axtkampf, Stabkampf, Bogen, Armbrust) nun in 10 Stufen ausbaubar. Einhand- und Zweihandwaffen werden gleich behandelt bzw ab einer gewissen Stufe sind Zweihandwaffen (Schwert oder Axt) auch einhändig zu tragen. Mir persönlich gefallen Nahkämpfer mit schnellen Waffen meist am Besten, und aus meiner Sicht habe diese einen klaren Vorteil gegenüber Fernkämpfern und Magiern - sie benötigen keine sich verbrauchende Munition wie Pfeile oder Mana. Das für das Erlernen von Zaubern benötigte Attribut Weisheit schließlich hat eine Sonderstellung im Spiel: Es wird von keinem Lehrer gelehrt, sondern nur durch Lesen von Büchern und alten Tafeln gesteigert. Den Maximalwert von 200 hat mein Nahkämpfer so problemlos erreicht.</p>
<p>Beim Thema Lernen blieb ansonsten alles beim Alten. Die durch das Sammeln von Erfahrungspunkten erreichten Charakterstufen werden mit Lernpunkten belohnt, die zusammen mit Münzen bei Lehrern gegen Fortschritte in den Primärattributen oder Fertigkeiten eingetauscht werden können. Gerade im Umgang mit dem Schwert wird der Spieler so flexibler im Kampf, jedoch hatte ich Schwierigkeiten, die neu gelernten Attacken sofort sinnvoll einzusetzen. Die Lehrer erzählen nur, was der Spieler lernt, aber ausprobieren kann man das Erlernte ausschließlich in Kämpfen, was schnell zum Heldentod oder dem Verlust der gesammelten Münzen führen kann. Ich würde mir wünschen, dass die Lehrer stattdessen mit dem Charakter ein Duell bestreiten, bei dem ich gefahrlos die neue Technik ausprobieren kann.</p>
<p>So fällt der Einstieg leider unnötig schwer. Anfangs fehlt es dem Spieler noch an Geld, um die meisten Aufträge durch Bestechung auszuführen, und an Kraft, um sich mit den Gegnern zu prügeln. Da gerade die Banditen-Storyline teilweise keine anderen Lösungsmöglichkeiten anbietet, ist zu Beginn des Spiels viel Frust angesagt. Ich spiele mittlerweile nur noch im leichtesten Schwierigkeitsgrad, der zwar manchmal zu einfach ist, aber zumindest Spaß macht, da ich nicht ständig sterbe. Schon auf Stufe normal verkommen die Kämpfe ansonsten zu einem endlosen Verstecken hinter dem eigenen Schild und vielen Versuchen, mit einem Schlag die Deckung des Gegners zu durchbrechen. Da erst mit Angriffskombinationen kritische Treffer möglich sind, allerdings die Gegner kaum die nötigen drei Schläge zulassen, musste ich mich anfangs damit begnügen, erst nach Dutzenden von Treffern den Kampf zu gewinnen. Durch einen einfacheren Spieleinstieg hätten die Entwickler einiges an Frust verhindern können.</p>
<p>Aber gut, dies bin ich eigentlich von der <em>Gothic</em>-Reihe gewohnt. In Teil II musste der Spieler in der ehemaligen Strafkolonie die Burg erreichen und hatte dabei die Optionen, durch eine Belagerung der zu diesem Zeitpunkt zu starken Orks zu brechen oder durch einen Fluss zu schwimmen, in dem sich genauso tödliche Snapper herumtrieben. Solche Wahlmöglichkeiten zwischen Pest und Cholera gehören einfach nicht ein sorgfältig ausbalanciertes Spiel.</p>
<p>So bleibt regelmäßiges Speichern neben einem guten Autosave Pflichtaufgabe, denn zu oft läuft man aus Versehen in eine Gruppe von überlegenen Gegner und hat nur selten die Chance, den Kämpfen lebend zu entkommen. Dabei ist gerade die offene Spielewelt, die dem Spieler nur Grenzen über solche starken Gegner setzt, die große Stärke von <em>Risen</em>. Theoretisch kann man überall hin laufen und jede Höhle, jeden Berg und jede Ruine erkunden. Praktisch ist dies jedoch erst ab Mitte des Spiels sinnvoll, will der Spieler nicht durchgängig Kämpfen aus dem Weg gehen, indem er an der aggressiven Fauna vorbeischleicht, die die Insel in großer Dichte bevölkert.</p>
<p>Wo in Spielen wie der <em>Elder-Scrolls</em>-Serie gähnende Leere herrscht und <em>The Witcher</em> und die Bioware-Rollenspiele den Spieler durch enge Wege lenken, fasziniert <em>Risen</em> durch seine lebendige Welt, die trotz der örtlichen Nähe zwischen Hafenstadt, Vulkanfestung und Banditenlager realistisch erscheint. Als Beispiel für das Funktionieren dieser Welt sei der Spion Doyle genannt, der nach seiner Enttarnung dem Helden verspricht, so zu verschwinden, dass ihn niemand findet. Wer jedoch richtig sucht, kann Doyle schließlich ganz oben an einem Wasserfall auf einer kleinen Ebene entdecken, die nur durch Levitation zu erreichen ist (und 50 Erfahrungspunkte einstreichen). So wie Doyle sind alle Charaktere in die Spielewelt integriert; niemand wirkt deplatziert oder verschwindet einfach. Da kann man auch darüber hinwegsehen, dass es ebenso wie in <em>Gothic III</em> bis auf Patty keine relevanten Frauencharaktere gibt und die wenigen weiblichen Figuren zumeist dem Wunschdenken der Programmierer entsprechen mit ihren großen Oberweiten und knappen Outfits.</p>
<p>Ebenso wie mit den Charakteren verhält es sich auch mit Gebäuden und Objekten - alles hat seinen Zweck und simuliert die mittelalterliche Welt sehr authentisch. Ein Schmiedeofen steht nur vor einer der Schmieden, und wenn der Held ein Schwert herstellen will, so muss er Ofen, Amboss, Wassertrog und Schleifstein nutzen. Für alle Fertigkeiten werden zudem Spezialwerkzeuge benötigt, so dass der Jäger neben dem Wissen um das Ausnehmen von Tieren auch Gegenstände wie Kiefernzangen und -meißel im Inventar haben muss.</p>
<p>Insgesamt bleiben technisch wie inhaltlich Innovationen aber Mangelware, wenn auch der Erfolg den Piranha Bytes Recht gibt. Die Rebellen- bzw Söldnerfraktion wird diesmal von den Banditen gestellt, in der Vulkanfestung werden Magier herangebildet und statt den Orks gibt es Echsenwesen, die an grundsätzlichem Körperbau und Stärke ihren Vorbildern in nichts nachstehen.</p>
<p>Spannender als die Dezimierung der weitgehend aus <em>Gothic</em> bekannten Tierwelt bleibt dagegen die Erkundung der Handlung und der Welt, in der sie eingebettet ist. Mehr, als dass die Götter verschwunden sind und die Menschheit kurz vor der Vernichtung durch die Titanen steht, erfährt der Spieler lange nicht und muss sich stattdessen mit dem Mikrokosmos der Insel begnügen. Dies erinnert nicht von ungefähr an die Anfänge der <em>Gothic</em>-Reihe mit der Gefängniskolonie, die später um die Insel Khorinis erweitert wurde und im dritten Teil schließlich das Königreich Myrtana präsentierte. Da <em>Risen II</em> bereits angekündigt ist verwundert es nicht, dass das Spiel mit einer Art Cliffhanger endet und viele Fragen zu den Titanen und Göttern offen lässt.</p>
<p>In Erinnerung bleibt am Ende ein Spiel, das in direkter Fortführung der <em>Gothic</em>-Reihe Evolution statt Revolution auf hohem Niveau betreibt. Die Selbstbeschränkung der Entwickler in Größe und Komplexität und eine Betatestphase führten dazu, dass ich nur einen leichten Bug während der immerhin 32 Stunden, die ich zum Durchspielen benötigte, gefunden habe. Ich kann das Spiel also nur weiterempfehlen, da es gerade im Vergleich zu der Demo des vor kurzem erschienen <em>Gothic 4 Arcania</em> das rundere Paket abliefert, selbst wenn letzteres den einfacheren Spieleinstieg bietet. Ich warte jetzt sehnsüchtig auf <em>Risen II</em>…</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kingoli\.net\/blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>