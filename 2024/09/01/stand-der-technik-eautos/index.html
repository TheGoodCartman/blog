<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.21">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Stand der Technik - E-Autos – The KingOli Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../k-typewriter.png" rel="icon" type="image/png">
<script src="../../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-b2bd955b7378b94aa8c2ba4fafa553c9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-9b374a920c22c713c620b2f0d2f807e9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../../k-typewriter.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">The KingOli Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TheGoodCartman"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Stand der Technik - E-Autos</h1>
  <div class="quarto-categories">
    <div class="quarto-category">gedacht</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">01.09.2024 15:55</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Schon seit dem ersten <a href="https://de.m.wikipedia.org/wiki/Tesla_Roadster_(2008)">Tesla Roadster</a> fasziniert mich die Elektromobilität, aber die Anforderungen einer Kleinfamilie und nicht ladetaugliche Mietverhältnisse waren bisher Blocker für ein eigenes e-Auto. So blieb es bei einigen Mitfahrten v.a. in Teslas, bis sich jetzt im Urlaub in Südfrankreich die Chance auf einen elektrischen Mietwagen ergab. Ich will nun über meine Erfahrungen mit dem <em>Mini Cooper SE</em> und der Ladeinfrastruktur (am Beispiel Südfrankreichs) berichten.</p>
<section id="mini-cooper-se" class="level3">
<h3 class="anchored" data-anchor-id="mini-cooper-se">Mini Cooper SE</h3>
<p>So ein Mini ist selbst für eine dreiköpfige Familie mit Koffern grenzwertig klein, dafür passte er zumindest durch jede noch so enge mittelalterliche Gasse in den Städtchens Okzitaniens. Die klassische Mini-Designsprache mit dem großen Rundinstrument in der Mittelkonsole wurde konsequent beibehalten, nur dass der gesamte Kreis nun von einem Display ausgefüllt wird und fast alle Schalter darunter durch eine Displaybedienung ersetzt wurden. Warum das keine gute Idee ist, werde ich gleich ausführen.</p>
<p>Hinter dem Lenkrad gibt es keine Anzeige mehr, diese wurde durch ein seltsames Head-Up-Display ersetzt, das jedoch nicht auf die Windschutzscheibe projiziert, sondern auf eine kleine Glasscheibe davor. Dadurch ist der Blickwinkel sehr begrenzt; außer dem Fahrer sieht niemand die Anzeige und selbst ich als großer Mensch kam schon in den vertikalen Bereich, wo es mit der Ablesbarkeit kritisch wurde.</p>
<p>Mit 1700km Laufleistung und keinem Kratzer war der Mietwagen quasi fabrikneu. Das hinderte ihn nicht daran, Probleme mit dem Schließen der Heckklappe zu haben. Nur mit sehr viel Nachdruck fiel die Klappe wirklich ins Schloss; sehr oft war sie optisch zu, hatte aber minimal Spiel und das Auto beschwerte sich über eine offene Tür.</p>
<p>Wie vermutlich alle modernen Autos macht der Mini auf sich aufmerksam, wenn die Höchstgeschwindigkeit überschritten wird. Maximal äußert sich dies durch ein Audiosignal und Vibration des Lenkrads: letzteres kann abgeschaltet werden, das Piepen aber nicht (bzw nur für die aktuelle Fahrt). Woher aber weiß das Auto, wie hoch die aktuell erlaubte Höchstgeschwindigkeit ist? Zum Einen aus den Kartendaten des Navis, das aber trotz Softwarestands vom Februar 2024 schon einige Fehler aufwies, zum Anderen durch Schildererkennung, die aber auch ihre Tücken hat. So werden zwar baustellenbezogene Geschwindigkeitsbegrenzungen erkannt, aber da diese nicht aufgehoben werden, war danach erst einmal kilometerlanges Piepen angesagt. Das kann mein fünf Jahre altes Auto genauso gut/schlecht, schade dass sich hier nichts weiterentwickelt hat.</p>
<p>Automatisches Ein- und Ausparken beherrscht der Mini ganz gut; die meisten anderen Assistenten (Spurhalten, Kollissionswarnung) mussten wir leider deaktivieren, da sie gerne das Steuer übernehmen und zu gefährlichen Situationen führten. So wollte der Mini einmal nicht von der Autobahn abfahren, weil er den Platz zum vorausfahrenden Auto als zu gering wahrnahm. Außerdem versteht er leicht abbiegende Straßen nicht, sieht parkende Autos vor einem als Hindernisse auf dem Weg und bremst abrupt. Auch hier: Es ist traurig, dass die Technik noch nicht gut genug ist bzw zu übergriffig für die eigene Fehleranfälligkeit.</p>
<p>Das ist schade, weil z.B. der Tempomat anbietet, sich an die Geschwindigkeitskeitlimits zu halten. Da fehlt auf den ersten Blick nicht mehr viel zum teilautonomen Fahren. Aber wenn der Tempomat übernimmt, sind alle anderen Assistenten deaktiviert (er würde so auf das vorausfahrende Auto auffahren); es fehlt also noch am Zusammenspiel.</p>
<p>Kommen wir nun zum alles dominierenden Runddisplay in der Mittelkonsole. Physische Bedienelement hat Mini maximal eingespart: Es gibt einen Knopf für die Feststellbremse, eine Wählschalter für die Automatik, einen Motor-An/Aus-Schalter als Ersatz für die klassische Zündung per Schlüssel, einen <em>Experience</em>-Wahlhebel und ein kleines Drehrad für die Lautstärke.</p>
<p>Ein paar Sachen (wie der Tempomat) können noch am Lenkrad verstellt werden, aber das war es auch schon. Alles andere wird über das Display oder per Sprache gesteuert. Die Spracherkennung war ordentlich, aber leider hing sich das komplette System gerne dabei auf. Dann war nichts mehr verfügbar: Kein Navi, aber auch keine Geschwindigkeitsanzeige. Zumindest reagierte das Auto noch auf das Gaspedal, aber so etwas darf während der Fahrt nicht passieren.</p>
<p>Also nutzten wir hauptsächlich die Bildschirmbedienung, die sich jedoch an einigen Stellen (Anpassung Klimaautomatik, Radio) sehr umständlich anführte. Da half auch nicht, dass das Auto gerne vergaß, dass das Radio beim letzten Fahren an war und welcher Sender eingestellt war. Einige Einstellungen (z.B. Ziele speichern im Navi) versteckt Mini auch hinter einem Cloud-Account. Ich verstehe, dass so etwas nützlich ist, wenn mit dem eigenen Auto per App Kontakt gehalten wird. Aber bei einem Mietwagen für zwei Wochen möchte ich so etwas bitte nicht.</p>
<p>Die Bedienung des Bildschirms folgt zudem keinem einheitlichen Konzept. Im Hintergrund arbeitet eine alte Android-Version, aber es gibt keine klassische Bedienleiste, so dass ich oft suchen musste, wie ich denn aus dem aktuellen Menü wieder herauskomme, da die Zurück-Buttons (falls vorhanden) an verschiedenen Stellen platziert waren. Und ins Hauptmenü kommt man ohnehin nur bei ausgeschaltetem Motor, was sehr ärgerlich ist, da nur dort die Fahrassistenzen angepasst werden können.</p>
<p>Ganz schick sind die <em>Experiences</em>, da damit nicht nur das Aussehen des Bildschirms, sondern auch die Lichter im Fahrzeuginnenraum angepasst werden. Allerdings gehen die meisten <em>Experiences</em> nicht über simple Farbschema hinaus, die man wohl selten während der Fahrt wechselt. Ich hätte deshalb gern den <em>Experiences</em>-Schalter gegen eine sinnvolle Einstellmöglichkeit getauscht.</p>
<p>Das Einzige, was mich wirklich überzeugt hat, ist die Nutzung fast der gesamten Displayfläche für die Navigation. Durch die Größe sind viele Details auf der Karte erkennbar, und eine Zielsuche per Hand auf der Karte (was mir als visuellem Typen entgegenkommt) ist gut möglich. Aber wo viel Licht, da auch Schatten: Neben dem leicht veralteten Kartenmaterial hatte die Positionsanzeige manchmal einen leichten Lag, was vor allem in den vielen Kreisverkehren Frankreichs dazu geführt hat, dass wir einige Male falsch abgebogen sind.</p>
</section>
<section id="ladeinfrastruktur" class="level3">
<h3 class="anchored" data-anchor-id="ladeinfrastruktur">Ladeinfrastruktur</h3>
<p>Unser Mietwagen war die Mini Cooper SE Version mit der 49,2 kWh Batterie, die Reichweiten von über 400km ermöglicht. Im warmen Südfrankreich mit so gut wie keiner Autobahnfahrt ist das auch realistisch und die 218PS haben mit dem agilen Mini auf den kurvigen, hügeligen Landstraßen sehr viel Spaß gemacht.</p>
<p>Doch irgendwann sind auch 49,2 kWh aufgebraucht. Unsere Unterkunft bot mit einem Tesla-Charger die Möglichkeit, über Nacht zu laden, doch aufgrund eines Fixpreises lohnte sich dies nur für die Vollladung. So habe ich mich in den Dschungel der Ladeanbieter begeben und durfte erst einmal viel lernen.</p>
<p>Dem Auto selber lag eine Ladekarte von Mini bei, die jedoch zwangsweise mit einem privaten Mini-Account gekoppelt werden muss. Ich wollte keine Zahlungsdaten in einem Mietwagen hinterlegen, also fiel diese Option schon einmal weg.</p>
<p>Also unternahm ich einen Versuch an Ladesäulen von Lidl. Theoretisch hätte ich über Anmeldungen in der deutschen Lidl-App und bei Lidl-Pay auch bei französischen Lidl-Märkten laden können, aber über einen QR-Code direkt an der Ladestation sollte dies auch ohne Logins möglich sein. Praktisch kam ich bis zum Blocken eines Betrags in Paypal, aber Strom floss niemals. Nach zehn Minuten vergeblichen Versuchens habe ich aufgegeben und nach einem Monat wurde auch der geblockte Betrag wieder freigegeben.</p>
<p>Nun ist in einem Urlaub das Zuschicken einer Karte der verschiedenen großen Ladeanbieter sehr unpraktikabel, also suchte ich nach einer Möglichkeit, die Ladesäulen per App zu aktivieren. Gelandet bin ich dann bei <a href="https://reveocharge.com/en/">Révéo</a>, die rund 1000 Ladestationen in Okzitanien betreiben und zur Abrechnung auf den deutschen Anbieter plugsurfing setzen, der auch die App beisteuert.</p>
<p>In dieser kann per Map nach Ladestationen gesucht werden, wobei von Steckertyp über Ladeleistung und Kosten bis hin zur Verfügbarkeit alle relavanten Informationen abrufbar waren. Auch Stationen anderer Anbieter konnten so genutzt werden. Die Tücke lag natürlich wie immer im Detail: Manchmal kamen wir an Stationen, die in der App als frei angezeigt wurden, aber defekt waren - was sich erst zeigte beim Versuch, das Laden zu aktivieren. Manchmal konnte die App auch die Station nicht überreden, das Laden zu starten. Und manche Ladesäulen versteckten sich auch in Tiefgaragen, was auf der Karte nicht ersichtlich war.</p>
<p>Doch wie wählt man eigentlich einen von den gerade in Städten erfreulich vielen Ladepunkten aus? Ein Faktor ist der Preis: Die eigenen Ladesäulen von Révéo hatten günstigere Konditionen als die von anderen Anbietern (Roaming genannt). In Gegenden mit hohem Parkdruck gibt es häufig Blockiergebühren, die durchaus mal 12 bis 30cent pro Minute (!) betragen können. Bei solchen Nebenkosten sind die Preise für die kWh fast schon nebensächlich; auf jeden Fall will jeder Ladevorgang gut geplant und berechnet werden.</p>
<p>Der Strompreis selber hängt stark von der Ladeleistung der Station ab. Die Fast Charger mit über 70kW DC sind oft doppelt so teuer wie die langsameren AC-Lader; durch die Blockiergebühren kann sich das aber trotzdem lohnen, vor allem wenn man nicht viel Zeit hat.</p>
<p>Am Ende spielt auch die Ladeleistung des Autos eine Rolle. Die meisten Ladepunkte hatten 5 oder 22kW Maximalleistung für AC - der Mini erlaubt 11kW; eine Vollladung (ca 5h) macht man aufgrund der Blockiergebühren so nicht.</p>
<p>Bleiben also die DC Schnelllader. Hier ging es für den Mini laut Datenblatt hoch bis zu 95kW; praktisch habe ich an einem 150kW-Lader knapp über 50kW erlebt (irgendwo im Idealbereich zwischen 20 und 80% Ladestand).</p>
<p>Am Ende habe ich einige Ladevorgänge unter “Erfahrungen sammeln” verbucht. Das System ist auf jeden Fall komplexer als das klassische Ranfahren-und-Tanken mit einem Verbrenner. Einen Vorteil hatte der elektrische Mietwagen jedoch: Wir haben den Wegen halbvoll zurückgegeben und nur knapp 12€ für das Aufladen bezahlt (ca 50cent pro kWh). Für 12€ hätten wir keinen Verbrennertank halbvoll bekommen, von den Aufpreisen der Mietwagenfirmen für das Tanken ganzu schweigen.</p>
<p>Am Ende war es eine Erfahrung, die mir gezeigt hat, dass ich durchaus mit einem eAuto durch den Alltag kommen würde - wenn ich denn die Möglichkeit hätte, zu Hause ohne die kreativen Preisgestaltungen der Ladesäulenanbieter zu laden. Am Besten noch mit Strom aus dem eigenen Solarkraftwerk - man darf ja noch träumen dürfen…</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/kingoli\.net\/blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>